<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Score Tracker</title>
    <link rel="stylesheet" href="public/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body >
    <!-- header -->
    <h1 class="m-5">Table Football Score Tracker</h1>

    <!-- Game Mode Toggle -->
    <div class="toggle-container">
        <button class="toggle-btn active" onclick="showSingleGame()">Single Game</button>
        <button class="toggle-btn" onclick="showTeamGame()">Team Game</button>
    </div>

    <!-- Single Game -->
    <section class="game-section" id="singleGameSection">
        <h2>Single Game</h2>
        <h3>Winner vs Loser</h3>
        <div class="input-container">
            <input type="text" id="inputBoxWinner" class="win" placeholder="Winner">
            <span class="vs">vs</span>
            <input type="text" id="inputBoxLoser" class="lose" placeholder="Loser">
        </div>
        <button onclick="saveInputSingle()">Save Game</button>
        <p id="statusSingleGame"></p>
    </section>

    <!-- Team Game -->
    <section class="game-section" id="teamGameSection" style="display: none;">
        <h2>Team Game</h2>
        <h3>Winning Team vs Losing Team</h3>
        <div class="input-container">
            <div class="team-group winning-team">
                <input type="text" id="inputBoxWinnerAttack" class="win" placeholder="Attacker">
                <input type="text" id="inputBoxWinnerDefense" class="win" placeholder="Defender">
            </div>
            <span class="vs">vs</span>
            <div class="team-group losing-team">
                <input type="text" id="inputBoxLoserAttack" class="lose" placeholder="Attacker">
                <input type="text" id="inputBoxLoserDefense" class="lose" placeholder="Defender">
            </div>
        </div>
        <button onclick="saveInputTeam()">Save Game</button>
        <p id="statusTeamGame"></p>
    </section>


<!-- front end JS -->
    <script>
    // Define API_BASE once, depending on hostname
    const API_BASE = window.location.hostname === 'localhost'
        ? 'http://localhost:3000'   //for local testing
        : 'https://tablefootballscoretracker.onrender.com';  // for prod

        // Toggle between game modes
        function showSingleGame() {
            document.getElementById('singleGameSection').style.display = 'flex';
            document.getElementById('teamGameSection').style.display = 'none';

            // Update toggle button styles
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            toggleBtns[0].classList.add('active');
            toggleBtns[1].classList.remove('active');
        }

        function showTeamGame() {
            document.getElementById('singleGameSection').style.display = 'none';
            document.getElementById('teamGameSection').style.display = 'flex';

            // Update toggle button styles
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            toggleBtns[0].classList.remove('active');
            toggleBtns[1].classList.add('active');
        }

        //Single game
        async function saveInputSingle() {
            const inputBoxWinner = document.getElementById("inputBoxWinner");
            const inputBoxLoser = document.getElementById("inputBoxLoser");
            //prevent spaces in input
            const winner = inputBoxWinner.value.trim();
            const loser = inputBoxLoser.value.trim();

            if (!winner || !loser) {
                return alert("Both fields are required for a single game!");
            }

            try {
                const responseSingle = await fetch(`${API_BASE}/saveSingle`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ winner, loser })
                });

                const resultSingle = await responseSingle.json();
                document.getElementById("statusSingleGame").innerText = resultSingle.message;

                // Clear fields after successful save
                inputBoxWinner.value = "";
                inputBoxLoser.value = "";
            } catch (error) {
                console.error("Error saving single game:", error);
                alert("Failed to save data. Check server connection.");
            }
        }
        //team game
        async function saveInputTeam() {
            const inputBoxWinnerAttack = document.getElementById("inputBoxWinnerAttack");
            const inputBoxWinnerDefense = document.getElementById("inputBoxWinnerDefense");
            const inputBoxLoserAttack = document.getElementById("inputBoxLoserAttack");
            const inputBoxLoserDefense = document.getElementById("inputBoxLoserDefense");
            //prevent spaces in input
            const winnerAttack = inputBoxWinnerAttack.value.trim();
            const winnerDefense = inputBoxWinnerDefense.value.trim();
            const loserAttack = inputBoxLoserAttack.value.trim();
            const loserDefense = inputBoxLoserDefense.value.trim();

            if (!winnerAttack || !winnerDefense || !loserAttack || !loserDefense) {
                return alert("All fields are required for a team game!");
            }

            try {
                const responseTeam = await fetch(`${API_BASE}/saveTeam`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ winnerAttack, winnerDefense, loserAttack, loserDefense })
                });

                const resultTeam = await responseTeam.json();
                document.getElementById("statusTeamGame").innerText = resultTeam.message;

                // Clear fields after successful save
                inputBoxWinnerAttack.value = "";
                inputBoxWinnerDefense.value = "";
                inputBoxLoserAttack.value = "";
                inputBoxLoserDefense.value = "";
            } catch (error) {
                console.error("Error saving team game:", error);
                alert("Failed to save data. Check server connection.");
            }
        }
    </script>
</body>
</html>
